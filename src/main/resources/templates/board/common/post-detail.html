<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê²Œì‹œê¸€ ìƒì„¸</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link rel="stylesheet" th:href="@{/board-skin/common-skin/post-skin/css/post-detail.css}">
    <!--    <link rel="stylesheet" href="post-detail.css">-->

    <!-- ì„œë²„ ë°ì´í„°ë¥¼ JavaScriptì— ì „ë‹¬í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ (ìˆ˜ì •ëœ ë²„ì „) -->
    <script th:inline="javascript">
        window.postDetailData = {
            postId: /*[[${postDetail.posts.postId}]]*/ null,
            reactType: /*[[${postDetail.reactType != null ? postDetail.reactType.toString() : 'NONE'}]]*/ 'NONE',
            likeCount: /*[[${postDetail.postsReactionCount != null ? postDetail.postsReactionCount.likeCount : 0}]]*/ 0,
            dislikeCount: /*[[${postDetail.postsReactionCount != null ? postDetail.postsReactionCount.dislikeCount : 0}]]*/ 0,
            isLoggedIn: /*[[${postDetail.reactType != null or postDetail.isAuthor}]]*/ false,
            isUserReported: /*[[${postDetail.isUserReported}]]*/ false
        };

        window.userCommentReportMap = /*[[${postDetail.userCommentReportMap}]]*/ {};
    </script>
</head>
<body class="post-detail-body">

<!-- ê²Œì‹œë¬¼ ì •ë³´ê°€ ì—†ì„ ë•Œ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ -->
<div th:if="${postDetail == null}" class="error-message">
    <h2>ê²Œì‹œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</h2>
    <p><a href="/board">ê²Œì‹œíŒ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a></p>
</div>

<!-- ê¸°ì¡´ HTML êµ¬ì¡°ëŠ” postDetailì´ ì¡´ì¬í•  ë•Œë§Œ í‘œì‹œ -->
<div th:if="${postDetail != null}" class="post-detail-container">
    <div class="post-header">
        <h1 class="post-title" th:text="${postDetail.posts.postTitle}">ê²Œì‹œê¸€ ì œëª©</h1>

        <div class="post-meta">
            <div class="post-meta-item">
                <strong>ì‘ì„±ì:</strong>
                <!-- User ì—”í‹°í‹°ì˜ mbNickName VO ì ‘ê·¼ ë°©ì‹ ìˆ˜ì • -->
                <span th:text="${postDetail.posts.user != null ? postDetail.posts.user.mbNickName.mbNickName : 'ì•Œ ìˆ˜ ì—†ìŒ'}">ë‹‰ë„¤ì„</span>
            </div>

            <div class="post-meta-item">
                <strong>ì‘ì„±ì¼:</strong>
                <span th:text="${#temporals.format(postDetail.posts.createdAt, 'yyyy-MM-dd')}">ë‚ ì§œ</span>
            </div>

            <div class="post-meta-item">
                <strong>ì¡°íšŒìˆ˜:</strong>
                <span th:text="${postDetail.posts.viewCount}">0</span>
            </div>
        </div>
    </div>

    <div class="post-content-wrapper">
        <div class="post-content">
            <p id="post-content" th:text="${postDetail.posts.getPostContent}">ê²Œì‹œê¸€ ë‚´ìš©</p>
        </div>

        <div class="post-attachments" th:if="${postDetail.hasPostFile}">
            <strong>ì²¨ë¶€ ì´ë¯¸ì§€:</strong>
            <div class="attachment-image" th:each="postFile : ${postDetail.postFilesList}">
                <img th:src="@{${postFile.fileUrl}}" alt="ì²¨ë¶€ ì´ë¯¸ì§€" class="post-image">
            </div>
        </div>
        <div class="post-attachments" th:unless="${postDetail.hasPostFile}">
            <p class="no-attachments">ì²¨ë¶€íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>

    <!-- ë¡œê·¸ì¸ ì‚¬ìš©ììš© ì¢‹ì•„ìš”/ì‹«ì–´ìš” ì„¹ì…˜ -->
    <div class="post-reactions" th:if="${postDetail.reactType() != null or postDetail.isAuthor != null}">
        <button id="like-button"
                class="like-button"
                th:classappend="${postDetail.reactType != null and postDetail.reactType.toString() == 'LIKE'} ? 'liked' : ''"
                aria-label="ì¢‹ì•„ìš” ë²„íŠ¼">
            <span id="like-icon"
                  th:text="${postDetail.reactType != null and postDetail.reactType.toString() == 'LIKE'} ? 'ğŸ’”' : 'â¤ï¸'">â¤ï¸</span>
            <span id="like-text"
                  th:text="${postDetail.reactType != null and postDetail.reactType.toString() == 'LIKE'} ? 'ì¢‹ì•„ìš” ì·¨ì†Œ' : 'ì¢‹ì•„ìš”'">ì¢‹ì•„ìš”</span>
            <span id="like-count" class="like-count"
                  th:text="${postDetail.postsReactionCount != null ? postDetail.postsReactionCount.likeCount : 0}">0</span>
        </button>

        <button id="dislike-button"
                class="dislike-button"
                th:classappend="${postDetail.reactType != null and postDetail.reactType.toString() == 'DISLIKE'} ? 'disliked' : ''"
                aria-label="ì‹«ì–´ìš” ë²„íŠ¼">
            <span id="dislike-icon"
                  th:text="${postDetail.reactType != null and postDetail.reactType.toString() == 'DISLIKE'} ? 'ğŸ‘' : 'ğŸ‘'">ğŸ‘</span>
            <span id="dislike-text"
                  th:text="${postDetail.reactType != null and postDetail.reactType.toString() == 'DISLIKE'} ? 'ì‹«ì–´ìš” ì·¨ì†Œ' : 'ì‹«ì–´ìš”'">ì‹«ì–´ìš”</span>
            <span id="dislike-count" class="dislike-count"
                  th:text="${postDetail.postsReactionCount != null ? postDetail.postsReactionCount.dislikeCount : 0}">0</span>
        </button>
    </div>

    <!-- ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ììš© ë©”ì‹œì§€ -->
    <div class="login-message" th:unless="${postDetail.reactType != null or postDetail.isAuthor != null}">
        <p>ì¢‹ì•„ìš”/ì‹«ì–´ìš”ë¥¼ ëˆ„ë¥´ë ¤ë©´ <a href="/login">ë¡œê·¸ì¸</a>ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
    </div>

    <!-- ì „ì²´ ë°˜ì‘ í†µê³„ -->
    <div class="reaction-stats" th:if="${postDetail.postsReactionCount != null}" style="text-align: center; margin: 10px 0; font-size: 14px; color: #666;">
        ì´ ë°˜ì‘: <span th:text="${postDetail.postsReactionCount.likeCount + postDetail.postsReactionCount.dislikeCount}">0</span>ê°œ
        (ì¢‹ì•„ìš” <span th:text="${postDetail.postsReactionCount.likeCount}">0</span>ê°œ,
        ì‹«ì–´ìš” <span th:text="${postDetail.postsReactionCount.dislikeCount}">0</span>ê°œ)
    </div>

    <div class="post-actions" id="memberForm" th:if="${postDetail.isAuthor}">
        <form id="updatePosts" method="get" action="/board/posts/edit" class="action-form">
            <input type="hidden" name="postId" th:value="${postDetail.posts.postId}">
            <input type="hidden" name="boardId" th:value="${postDetail.posts.board.boardId}">
            <button type="submit" class="edit-button">ìˆ˜ì •í•˜ê¸°</button>
        </form>

        <form id="deletePosts" class="action-form">
            <input type="hidden" name="postId" th:value="${postDetail.posts.postId}">
            <input type="hidden" name="boardId" th:value="${postDetail.posts.board.boardId}">
            <button type="submit" class="delete-button">ì‚­ì œí•˜ê¸°</button>
        </form>
    </div>

    <div class="navigation-actions">
        <a th:href="@{'/board/' + ${postDetail.posts.board.boardId} + '/view'}" class="back-button">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <!-- ëŒ“ê¸€ ì…ë ¥í¼ í¬í•¨ -->
    <div id="comment-section" class="comment-section">
        <div th:replace="~{board/comment/comment-form :: commentFormFragment}"></div>
        <hr class="comment-separator">
        <div th:replace="~{board/comment/comment-view :: commentListFragment}"></div>
    </div>
</div>

<script th:src="@{/board-skin/common-skin/post-skin/js/post-detail.js}"></script>
<script th:src="@{/board-skin/common-skin/post-skin/js/post-detail-report.js}"></script>
<script th:src="@{/board-skin/comment-skin/js/comment-form.js}"></script>
<script th:src="@{/board-skin/comment-skin/js/comment-report.js}"></script>
<!--<script src="post-detail.js"></script>-->
</body>
</html>